<!DOCTYPE html><html><head><script>var host = ".github.io"; if (/\.github.io/.test(window.location.host) && window.location.protocol != "https:") window.location.protocol = "https";</script><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, target-densityDpi=medium-dpi"><meta content="True" name="HandheldFriendly"><title>A hint of chaos</title><link rel="shortcut icon" href="/ico/favicon.ico"><link rel="stylesheet" href="/styles/style.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/default.min.css"><link rel="alternate" type="application/rss+xml" title="spion.github.io" href="/rss.xml"></head><body><div class="main"><aside class="info-tiny"><a class="img" href="/"><img src="https://secure.gravatar.com/avatar/d924ad2ac22af6216aadd2e9184616de?s=144"></a><h1 class="first"><a href="/">Gorgi Kosev</a></h1><p class="subtitle">code, music, math</p></aside><div class="info"><a class="img" href="/"><img src="https://secure.gravatar.com/avatar/d924ad2ac22af6216aadd2e9184616de?s=144"></a><h1 class="first"><a href="/">Gorgi Kosev</a></h1><p class="subtitle">code, music, math</p><p class="subtitle margin"><a href="http://twitter.com/spion">@spion</a></p></div><main class="rest"><div><article class="post"><h1><a href="posts/lockdowns-work/index.html">COVID-19: Lockdowns work</a></h1><div class="date">Sat May 29 2021</div><div class="content"><p>Lockdowns work.</p>
<p>You may have heard that they don't.</p>
<p>Most studies that come to this conclusion make one or more of the following mistakes</p>
<h3>Use of case counts instead of growth rate</h3>
<p>Most studies that look whether NPIs work tend to look at absolute case numbers (adjusted for
population size) and try to correlate them with NPIs like stringency measures.</p>
<p>The core error made in this case is that NPIs don't affect the case numbers directly. Instead, they
affect <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">R_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, or the rate of spread of the virus. If you think about it, it makes a lot of sense:
a person with COVID staying at home doesn't affect the current number of cases. They are still sick.
What they do affect is how many people they are going to infect. By minimizing the amount of time
and number of people they spend in contact with, they minimize the chances of transmitting the
virus.</p>
<p>Why is this important? Lets say the following happens:</p>
<ul>
<li>A country starts with <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">R_t=2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>. Their cases are growing</li>
<li>They apply some interventions (lockdown). This gets them to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub><mo>=</mo><mn>1.5</mn></mrow><annotation encoding="application/x-tex">R_t = 1.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span></span></span></span></li>
</ul>
<p>Now if we look at cases vs rate of growth, we get the following:</p>
<ul>
<li>The case graphs look about the same. Cases are still growing, so the measures applied &quot;don't work&quot;</li>
<li>If we look at the rate of growth, we'll actually see that they work, but they're not enough to
reverse the exponential process from growing to shrinking (For that we need <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">R_t &lt; 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>).</li>
</ul>
<p>So while looking at cases, we can't see whether measures are actually working until they're good
enough to get <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">R_t &lt; 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></p>
<p>The situation is even worse if we look at case number totals. Then, the timing of the lockdowns also
affects the outcome. A country that spends the same total amount of time in lockdowns but starts 3
weeks earlier could have vastly different outcomes than if they started later, because they let the
&quot;base&quot; of the exponent accumulate:</p>
<p><img src="https://pbs.twimg.com/media/EtgQd4EXEAIWghL?format=jpg&amp;name=medium" alt="img"></p>
<p>Still, you might object - if that worked, we would still see a lot less virus in countries that have
more stringent measures? The answer is no, but to figure out why, we need to get to the second
problem, which is:</p>
<h3>Comparing countries (multivariate problems as univariate)</h3>
<p>As someone who has lived in 2 and visited (for an extended period of time) 3 countries in their
life, we tend to underestimate just how different countries are, and how different the typical life
of a person in those countries is. Variables include public transport vs cars, large supermarkets
versus tiny shops, building ventilation codes, bar/pub ventilation codes, outdoors vs indoors
venues, average household size, population density, climate and so on.</p>
<p>Comparing between countries is statistically futile. Its much better to compare the exact same place
with itself before and after the introduction (or release) of NPIs (non-pharmaceutical
interventions). That way, you can see what kind of difference that particular intervention makes,
and you are no longer affected by any variables that are different across locations.</p>
<p>And we're down to the last problem, which is</p>
<h3>Looking at stringency measures vs population behavior</h3>
<p>A lot of studies measure various &quot;stringency index&quot; as the input variables. This is unfortunately
also flawed. How effective a measure is will depend on a lot of things, including how much people
believe in it. Convincing people that lockdowns don't work makes lockdowns less effective, for
example. The fact that its Christmas or another religious holiday will also make people more likely
to ignore decrees. Cultural factors could also be in play. Inability to stay at home due to lack of
support from work might also play a role, and so on.</p>
<p>Its much better to measure real behavior. Google provides us with a variable called &quot;percentage
increase in stay at home time&quot;. The way they calculate this is by getting the baseline amount of
time people spent at home daily around February 2020, then letting us know (for each country and
each region) how much that time has increased or decreased relative to the baseline.</p>
<p>For example, if people in the UK stayed at home 14h/day at home on average in February 2020, and
they now spend 20h/day at home, that is around 40% increase relative to the baseline.</p>
<p>This measure is not perfect. For one, outdoor activities are much safer than indoor ones but not
counted as staying at home. For another, people in a country that have the habit of visiting each
other a lot would completely skew the results. But its far less flawed than the stringency index.</p>
<h3>Combining all corrections</h3>
<p>If we combine all corrections, we get the following result for the UK.</p>
<p><img src="https://pbs.twimg.com/media/E2lQJkvWEAYewr6?format=jpg&amp;name=large" alt="end result"></p>
<p>Rate of growth (percentage change) of cases, hospitalizations and deaths is almost perfectly
inversely proportional to the increase of time spent at home</p>
<p><a href="https://colab.research.google.com/drive/1j6-oU5Ro1Gv_sfJGJLRauBM7r2y91WwK#scrollTo=68PgZVFh1P79">Stats for more countries available at this link</a> -
you can see that people in Sweden, for example, did increase the amount of time they spend at home
substantially</p>
<p><a href="https://colab.research.google.com/drive/1OUDtnrac_seDldbT18tyJbh9PBItu0rP#scrollTo=68PgZVFh1P79">Stats for USA states available at this link</a></p>
</div><div class="comments"><hr/><a href="posts/lockdowns-work/index.html#_comments">comment or share</a></div></article><article class="post"><h1><a href="posts/absolute-risk-reduction-v2.html">Absolute risk reduction and COVID vaccines</a></h1><div class="date">Sun May 16 2021</div><div class="content"><p>The latest bit of misinformation on COVID is about absolute risk reduction of COVID vaccines. For
example, <a href="https://en.wikipedia.org/wiki/Peter_Attia">Peter Attia</a> posted a video on this topic a
couple of weeks ago, stating that ARR is about 1% as measured by the trials, which is completely
misleading:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/u1wEruG4jys" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>ARR and number needed to treat are a staple for doctors. So why is it not applicable to these COVID
vaccine trials?</p>
<p>To understand why, lets first briefly review how the COVID vaccine trials work.</p>
<p>In the COVID vaccine trial, people are randomly chosen to be placed into two groups: a control group
and a treatment group. The treatment group is given the actual vaccine, whereas the control group is
given some placebo (saline water or an unrelated vaccine).</p>
<p>Importantly, in the next step participants are told to observe all precautions that non-vaccinated
people are advised to observe: to mask, to socially distance and in general to avoid situations
where they may be exposed to the virus.</p>
<p>During this time, the prevalence of the virus is controlled by other means: distancing, stay at home
orders, masks, periodic rapid antigen tests and any other tools at our disposal.</p>
<p>Despite precautions, a percentage of participants will be unfortunate enough to be exposed to
someone infectious. When that happens, a further sub-percentage of them in both groups will become
infected, and symptomatic.</p>
<p>The trials for Pfizer and Moderna were designed to stop at a fixed number of infections. Moderna had
30,000 participants, with 15,000 in the control and intervention group each. Pfizer had around</p>
<p>We can measure the relative risk reduction by comparing the number of symptomatic infected in the
control group and in the intervention group. For example, if we had 100 people infected in the
control group but only 10 in the intervention, the relative risk reduction of that vaccine would be
90%</p>
<p>But what about absolute risk reduction?</p>
<p>We can't measure that.</p>
<p>&quot;Why not?&quot; you might wonder. If we have the size of the control group - e.g. 10 000 people, and the
size of the intervention group (e.g. also 10 000 people), shouldn't the absolute risk be really easy
to calculate? i.e.</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mi>R</mi><mi>R</mi><mo>=</mo><mfrac><mn>100</mn><mn>10000</mn></mfrac><mo>−</mo><mfrac><mn>1</mn><mn>10000</mn></mfrac><mo>=</mo><mn>0.9</mn></mrow><annotation encoding="application/x-tex">ARR = { 100 \over 10 000 } - { 1 \over 10000 } = 0.9% 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">9</span></span></span></span></span>
<p>The answer is no, and here is why.</p>
<p>In medication experiments where we measure ARR / NNT, the medications are given to a population with
relatively stable characteristics. The percentage of people who are at risk to develop sickness does
not change all that much.</p>
<p>In contrast, in the COVID vaccine experiments, only a small percentage of the population is exposed
to infectious virus because we're using other (very expensive) means to control the rate of growth.
The typical prevalence while we run these experiments is less than 2%. For example, see the
<a href="https://www.ons.gov.uk/peoplepopulationandcommunity/healthandsocialcare/conditionsanddiseases/bulletins/coronaviruscovid19infectionsurveypilot/8january2021">ONS survey data in England for January 2021</a>
which measured 2% prevalence in England at the worst possible period of the pandemic.</p>
<p>How many people in the control and intervention group were exposed to COVID? We don't know, but its
not likely to be much higher than 1-3%, depending on the community prevalence of the disease at the
time the experiment was done. To really measure absolute risk reduction, we would have to ensure
that we develop conditions for our trial groups that are similar to those when the restrictions are
completely lifted. What would that mean? If restrictions are lifted, within a few months, perhaps a
year, at least 80-90% of people would eventually be exposed to the virus. That is 30 times as many
as during a typical COVID vaccine trial! (Numbers are illustrative, but an order of magnitude
difference is almost certain)</p>
<p>So how do we achieve that in the experiment? Everyone in both the control and the intervention group
would need to be acting without any precaution to get &quot;naturally&quot; exposed to COVID. Furthermore,
everyone they're in contact with should also act without precautions to ensure there is a realistic
probability that they're an infectious contact. Alternatively, the groups would deliberately need to
expose themselves to the virus. Since its completely unethical to run an experiment like that, its
not possible to recreate realistic conditions for the disease. Therefore, its not possible to
measure ARR in the same way that its measured for medications.</p>
<p>The best we can do is try to extrapolate what that number would be. We know around 50%-60% are
susceptible to developing symptomatic infection. If our absolute risk reduction measured when there
was 1.5% prevalence was 1%, then the absolute risk reduction of developing symptomatic infection
would probably be something closer to 35%</p>
<p>We don't know the exact ARR of COVID vaccines. But we know that its a lot closer to RRR, and nowhere
near to the &quot;ARR&quot; number we can extrapolate from vaccine trials - that number is completely
meaningless and depends heavily on the prevalence of the virus at the time of the trial.</p>
</div><div class="comments"><hr/><a href="posts/absolute-risk-reduction-v2.html#_comments">comment or share</a></div></article><article class="post"><h1><a href="posts/growth-rate-matters/index.html">COVID-19: Case counts don't matter. Growth does</a></h1><div class="date">Thu Sep 10 2020</div><div class="content"><p>The growth of cases is another hot and controversial COVID-19 topic. On one hand, the number of
daily is getting to be very large in many European countries. On the other, it doesn't look like
this rise in cases is having the same impact as it had before. There is a theory that proposes there
might be a lot of dead virus being detected, as well as that the increased amount of testing is the
reason behind the increased amount of cases, most of them asymptomatic. As such, we should be
ignoring the case numbers and focus on other metrics such as hospitalizations.</p>
<p>In this blog post I hope to convince that case numbers aren't useless. But we should neither be
looking at the absolute number of cases nor wait for hospitalizations and deaths to kick in.
Instead, we should be looking at the growth rate (or <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">R_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> estimates). Through the growth rate,
the case counts, no matter how flawed can provide a great early warning system.</p>
<h3>The case of Spain</h3>
<p>One of the first countries to have a &quot;second wave&quot; of cases was Spain. Lets load up the &quot;our world
in data&quot; dataset and compare the two waves to see how they look like.</p>
<pre><code class="language-python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
plt.rcParams[<span class="hljs-string">'figure.dpi'</span>] = <span class="hljs-number">150</span>
plt.rcParams[<span class="hljs-string">'figure.figsize'</span>] = [<span class="hljs-number">6.0</span>, <span class="hljs-number">4.0</span>]
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
dateparse = <span class="hljs-keyword">lambda</span> x: datetime.strptime(x, <span class="hljs-string">'%Y-%m-%d'</span>)
owid = pd.read_csv(<span class="hljs-string">'https://covid.ourworldindata.org/data/owid-covid-data.csv'</span>, parse_dates=[<span class="hljs-string">'date'</span>], date_parser=dateparse)

</code></pre>
<p>Spain's first wave started at the beginning of March, while the second wave is still ongoing in
August. Lets plot those on the same chart:</p>
<pre><code class="language-python">esp = owid[owid.iso_code.eq(<span class="hljs-string">"ESP"</span>)]

wave1 = esp.loc[(owid[<span class="hljs-string">'date'</span>] &gt; <span class="hljs-string">'03-01-2020'</span>) &amp; (owid[<span class="hljs-string">'date'</span>] &lt;= <span class="hljs-string">'03-29-2020'</span>)];
wave2 = esp.loc[(owid[<span class="hljs-string">'date'</span>] &gt; <span class="hljs-string">'08-01-2020'</span>) &amp; (owid[<span class="hljs-string">'date'</span>] &lt;= <span class="hljs-string">'08-29-2020'</span>)];

wave1 = wave1.reset_index().rename(columns={<span class="hljs-string">'new_cases_smoothed'</span>: <span class="hljs-string">'Spain March'</span>})[<span class="hljs-string">'Spain March'</span>]
wave2 = wave2.reset_index().rename(columns={<span class="hljs-string">'new_cases_smoothed'</span>: <span class="hljs-string">'Spain August'</span>})[<span class="hljs-string">'Spain August'</span>]
</code></pre>
<pre><code class="language-python">plot = pd.concat([wave1, wave2], axis=<span class="hljs-number">1</span>).plot(grid=<span class="hljs-literal">True</span>)
</code></pre>
<p><img src="/posts/growth-rate-matters/output_4_0.png" alt="png"></p>
<p>The chart looks very scary, but we can't easily infer the growth rate of the virus by looking at it.
Lets try a log plot:</p>
<pre><code class="language-python">plot = pd.concat([wave1, wave2], axis=<span class="hljs-number">1</span>).plot(logy=<span class="hljs-literal">True</span>, grid=<span class="hljs-literal">True</span>)
</code></pre>
<p><img src="/posts/growth-rate-matters/output_6_0.png" alt="png"></p>
<p>Ok, thats interesting. It appears that despite the case numbers being very high, the growth is
significantly slower this time around. Lets try and compare the 5-day rate of growth (which should
be pretty close to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">R_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>)</p>
<pre><code class="language-python">wave1growth = wave1.pct_change(periods=<span class="hljs-number">5</span>) + <span class="hljs-number">1</span>
wave2growth = wave2.pct_change(periods=<span class="hljs-number">5</span>) + <span class="hljs-number">1</span>
plot = pd.concat([wave1growth, wave2growth], axis=<span class="hljs-number">1</span>).plot(grid=<span class="hljs-literal">True</span>)
</code></pre>
<p><img src="/posts/growth-rate-matters/output_8_0.png" alt="png"></p>
<p>Wow, that is a huge difference. The rate of spread is not even close to the level in March. Lets try
zooming in on the period in the middle of the month</p>
<pre><code class="language-python">wave1growth = wave1.pct_change(periods=<span class="hljs-number">5</span>).iloc[<span class="hljs-number">15</span>:] + <span class="hljs-number">1</span>
wave2growth = wave2.pct_change(periods=<span class="hljs-number">5</span>).iloc[<span class="hljs-number">15</span>:] + <span class="hljs-number">1</span>
plot = pd.concat([wave1growth, wave2growth], axis=<span class="hljs-number">1</span>).plot(grid=<span class="hljs-literal">True</span>)
</code></pre>
<p><img src="/posts/growth-rate-matters/output_10_0.png" alt="png"></p>
<p>It looks like the growth rate barely went close to 1.5 in August, while in March it was well above 2
for the entire month!</p>
<p>But, why is the growth rate so important? I'll try and explain</p>
<h2>The growth rate is the most important metric</h2>
<p>There are several reasons why the growth rate is so important</p>
<h4>Its resistant to errors or CFR changes</h4>
<p>Yes, the rate of growth is largely resilient to errors, as long as the nature of those errors
doesn't change much over a short period of time!</p>
<p>Lets assume that 5% of the PCR tests are false positives. Lets say the number of daily tests is
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>N</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">N_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, of which 12% is the percentage of true positives today, while 10% is the number of true
positives 5 days ago. In this situation, one third of our tests consist of errors - thats a lot!</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub><mo>=</mo><mfrac><mrow><mn>0.05</mn><msub><mi>N</mi><mi>t</mi></msub><mo>+</mo><mn>0.12</mn><mi>N</mi><mi>t</mi></mrow><mrow><mn>0.05</mn><msub><mi>N</mi><mi>t</mi></msub><mo>+</mo><mn>0.1</mn><mi>N</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mfrac><mn>17</mn><mn>15</mn></mfrac></mrow><annotation encoding="application/x-tex">R_t = {0.05N_t + 0.12Nt \over 0.05N_t + 0.1Nt} = {17 \over 15} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.19633em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">5</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">1</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">5</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">1</span><span class="mord">2</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord">5</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord">7</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span>
<p>Without the errors, we would get</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub><mo>=</mo><mfrac><mrow><mn>0.12</mn><mi>N</mi><mi>t</mi></mrow><mrow><mn>0.1</mn><mi>N</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mfrac><mn>12</mn><mn>10</mn></mfrac><mo>=</mo><mfrac><mn>18</mn><mn>15</mn></mfrac></mrow><annotation encoding="application/x-tex">R_t = {0.12Nt \over 0.1Nt} = {12 \over 10} = {18 \over 15} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.04633em;vertical-align:-0.686em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span><span class="mord">.</span><span class="mord">1</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span><span class="mord">.</span><span class="mord">1</span><span class="mord">2</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord">0</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord">5</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord">8</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span>
<p>Pretty close - and whats more, the increase in errors causes under-estimation, not over-estimation!
Note that growth means that the error will matter less and less over time unless tests scale up
proportionally.</p>
<p>A similar argument can be made for people who have already had the virus, where the PCR detects
virus that is no longer viable. We would expect the number of cases to track the number of tests, so
the rate of growth would likely be lower, not higher.</p>
<blockquote>
<p>Note: the case with asymptomatics is slightly different. We could be uncovering clusters at their
tail end. But once testing is at full capacity, the probability is that we would uncover those
earlier rather than later, as the number of active cases would be declining at that point.</p>
</blockquote>
<h4>It can be adjusted for percentage of positive tests</h4>
<p>Lets say that the number of tests is changing too quickly. Is this a problem?</p>
<p>Not really. From the rate of growth, we can compensate for the test growth component, easily.</p>
<table>
<thead>
<tr>
<th>x</th>
<th>Cases</th>
<th>Tests</th>
</tr>
</thead>
<tbody>
<tr>
<td>Today</td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>N</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">N_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">T_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></td>
</tr>
<tr>
<td>5d ago</td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>N</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">N_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">T_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></td>
</tr>
</tbody>
</table>
<p>The adjusted rate of growth is</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub><mi>a</mi><mo>=</mo><mfrac><mrow><msub><mi>N</mi><mn>2</mn></msub><msub><mi>T</mi><mn>1</mn></msub></mrow><mrow><msub><mi>N</mi><mn>1</mn></msub><msub><mi>T</mi><mn>2</mn></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">R_ta = {N_2 T_1 \over N_1 T_2} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.19633em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span>
<h4>Better picture than absolute numbers</h4>
<p>Its best not to look at absolute numbers at all. Hindsight is 20:20, so lets see what the world
looked like in Spain from the perspective of March 11th:</p>
<pre><code class="language-python">esp_march = esp.loc[(owid[<span class="hljs-string">'date'</span>] &gt; <span class="hljs-string">'03-01-2020'</span>) &amp; (owid[<span class="hljs-string">'date'</span>] &lt;= <span class="hljs-string">'03-11-2020'</span>)];
plot = esp_march.plot(grid=<span class="hljs-literal">True</span>, x=<span class="hljs-string">'date'</span>, y=<span class="hljs-string">'new_cases_smoothed'</span>)
</code></pre>
<p><img src="/posts/growth-rate-matters/output_13_0.png" alt="png"></p>
<p>Only 400 cases, nothing to worry about. But if we look at <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">R_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> instead</p>
<pre><code class="language-python">esp_march_growth = esp_march.reset_index()[<span class="hljs-string">'new_cases_smoothed'</span>].pct_change(periods=<span class="hljs-number">5</span>)
plot = esp_march_growth.plot(grid = <span class="hljs-literal">True</span>)
</code></pre>
<p><img src="/posts/growth-rate-matters/output_15_0.png" alt="png"></p>
<p>The rate of growth is crazy high! We must do something about it!</p>
<h4>It encompasses everything else we do or know</h4>
<p>Antibody immunity, T-cell immunity, lockdowns and masks. Their common theme is that they all affect
or try to affect the rate of growth:</p>
<ul>
<li>If a random half of the population magically became immune tomorrow, the growth rate will probably
be halved as well</li>
<li>If masks block half of the infections, the growth rate would also be halved.</li>
<li>If 20% of the population stays at home, the number of potential interactions goes down to 64% - a
one third reduction in the rate of growth (most likely)</li>
</ul>
<h4>Early growth dominates all other factors</h4>
<p>With the following few examples lets demonstrate that getting an accurate estimate of the growth
rate and its early control is the most important thing and other factors (absolute number of cases,
exact CFR etc) are mostly irrelevant</p>
<pre><code class="language-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">generate_growth</span><span class="hljs-params">(pairs)</span>:</span>
    result = [<span class="hljs-number">1</span>]
    num = <span class="hljs-number">1</span>
    <span class="hljs-keyword">for</span> days, growth <span class="hljs-keyword">in</span> pairs:
        <span class="hljs-keyword">while</span> days &gt; <span class="hljs-number">0</span>:
            num = num * growth
            result.append(num)
            days = days - <span class="hljs-number">1</span>

    <span class="hljs-keyword">return</span> result

big_growth = generate_growth([(<span class="hljs-number">14</span>, <span class="hljs-number">1.5</span>), (<span class="hljs-number">21</span>, <span class="hljs-number">1.05</span>)])
small_growth = generate_growth([(<span class="hljs-number">42</span>, <span class="hljs-number">1.2</span>)])

df = pd.DataFrame(list(zip(big_growth, small_growth)), columns=[<span class="hljs-string">'big_growth'</span>, <span class="hljs-string">'small_growth'</span>])

df.plot()
</code></pre>
<p><img src="/posts/growth-rate-matters/output_18_1.png" alt="png"></p>
<p>In the above chart, &quot;big growth&quot; represents a country with a big daily growth rate of 50% for only 2
weeks, followed by a much lower growth rate of 5% caused by a stringent set of measures. &quot;small
growth&quot; represents a country with a daily growth rate of 20% that never implemented any measures.</p>
<p>This chart makes it clear that growth rate trumps all other factors. If a country's growth rate is
small, they can afford not to have any measures for a very long time. If however the growth rate is
high, they cannot afford even two weeks of no measures - by that point its already very late.</p>
<pre><code class="language-python">
</code></pre>
</div><div class="comments"><hr/><a href="posts/growth-rate-matters/index.html#_comments">comment or share</a></div></article><article class="post"><h1><a href="posts/uk-sweden-growth/index.html">COVID-19: Can you really compare the UK to Sweden?</a></h1><div class="date">Sat Sep 05 2020</div><div class="content"><p>When it comes to COVID-19, Sweden seems to be mentioned as a good model to follow quite often by lockdown skeptics. The evidence they give is that despite not locking down, Sweden did comparably well to many other European countries that did lock down - for example, the UK.</p>
<p>Lets see why this comparison is inadequate as the countries were behaving very differently before any lockdown or mass measures were introduced.</p>
<p>This entire blog post is a valid Jupyther notebook. It uses data that is fully available online. You should be able to copy the entire thing and paste it into Jupyther, run it yourself, tweak any parameters you want. It should make it easier to review the work if you wish to do that, or try and twist the data to prove your own point.</p>
<p>Lets load up both countries stats from ourworldindata:</p>
<pre><code class="language-python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime, timedelta

plt.rcParams[<span class="hljs-string">'figure.dpi'</span>] = <span class="hljs-number">150</span>
plt.rcParams[<span class="hljs-string">'figure.figsize'</span>] = [<span class="hljs-number">6.0</span>, <span class="hljs-number">4.0</span>]
dateparse = <span class="hljs-keyword">lambda</span> x: datetime.strptime(x, <span class="hljs-string">'%Y-%m-%d'</span>)
owid_url = <span class="hljs-string">'https://covid.ourworldindata.org/data/owid-covid-data.csv'</span>
owid = pd.read_csv(owid_url, parse_dates=[<span class="hljs-string">'date'</span>], date_parser=dateparse)
</code></pre>
<p>We can get the countries data by their ISO code</p>
<pre><code class="language-python">codes = [<span class="hljs-string">"GBR"</span>, <span class="hljs-string">"SWE"</span>, <span class="hljs-string">"ITA"</span>, <span class="hljs-string">"IRL"</span>, <span class="hljs-string">"ESP"</span>, <span class="hljs-string">"FRA"</span>]
</code></pre>
<p>Now lets compare deaths. We'll start the comparison when both countries deaths per million go above 0.25 per day to match the percentage of succeptable people. We're using the weekly moving average column from ourworldindata in order to get a better sense of the trend. We're going to take 5 weeks of data</p>
<pre><code class="language-python">countries = {}

populations = { <span class="hljs-comment"># in million</span>
    <span class="hljs-string">"GBR"</span>: <span class="hljs-number">66.0</span>,
    <span class="hljs-string">"SWE"</span>:  <span class="hljs-number">10.0</span>,
    <span class="hljs-string">"ITA"</span>:  <span class="hljs-number">60.0</span>,
    <span class="hljs-string">"IRL"</span>:  <span class="hljs-number">5.0</span>,
    <span class="hljs-string">"ESP"</span>: <span class="hljs-number">47.0</span>,
    <span class="hljs-string">"FRA"</span>:<span class="hljs-number">67.0</span>
}

<span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> codes:
    cntr = owid[(owid.iso_code.eq(name)) &amp; (owid.new_deaths_smoothed / populations[name] &gt; <span class="hljs-number">0.25</span>)]
    reindexed = cntr.reset_index()
    countries[name] = reindexed;

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">take</span><span class="hljs-params">(name)</span>:</span>
    <span class="hljs-keyword">return</span> countries[name].rename(columns={<span class="hljs-string">'new_deaths_smoothed'</span>: name})[name]


plot = pd.concat([take(<span class="hljs-string">'GBR'</span>), take(<span class="hljs-string">'SWE'</span>)], axis = <span class="hljs-number">1</span>).iloc[:<span class="hljs-number">35</span>].plot(grid=<span class="hljs-literal">True</span>, logy=<span class="hljs-literal">True</span>)
</code></pre>
<p><img src="output_5_0.png" alt="png"></p>
<p>Okay, so it looks like the deaths in the UK were growing a bit faster than the deaths in Sweden from the very beginning! Lets look at the growth rate with period 5 days. This growth rate should be a crude approximation of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">R_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> - its based on the fact that people seem to be most infections around 5 days after contracting the virus. To avoid noisiness when the number of deaths is very low, we'll add <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">1 \over 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> death per million of population. This should cause <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">R_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> to drop closer to 1 when deaths per million are fairly low:</p>
<pre><code class="language-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">growth</span><span class="hljs-params">(name)</span>:</span>
    <span class="hljs-keyword">return</span> (take(name) + populations[name]/<span class="hljs-number">2</span>).pct_change(periods=<span class="hljs-number">5</span>) + <span class="hljs-number">1</span>

plot = pd.concat([growth(<span class="hljs-string">'GBR'</span>), growth(<span class="hljs-string">'SWE'</span>)], axis = <span class="hljs-number">1</span>).iloc[:<span class="hljs-number">35</span>].plot(grid=<span class="hljs-literal">True</span>, logy=<span class="hljs-literal">True</span>)

</code></pre>
<p><img src="/posts/uk-sweden-growth/output_7_0.png" alt="png"></p>
<p>It looks like the rate of growth was higher in the UK during a crucial 10 day period before the middle of March, with a growth factor (analog to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">R_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>) that is about 30% higher. Now lets try and extrapolate what was going on in terms of cases that produced these deaths.</p>
<p>The mean time from infection to death for patients with fatal outcomes is 21 days. The standard deviation has been estimated to be anywhere between 5 and 7 days. Lets try to keep things simple and stick to 21 days</p>
<pre><code class="language-python">case_ranges = {}

<span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> codes:
    case_ranges[name] = [countries[name].iloc[<span class="hljs-number">0</span>][<span class="hljs-string">'date'</span>]  - timedelta(days=<span class="hljs-number">21</span>), countries[name].iloc[<span class="hljs-number">0</span>][<span class="hljs-string">'date'</span>]  + timedelta(days=<span class="hljs-number">14</span>)]

print(<span class="hljs-string">'GBR'</span>, case_ranges[<span class="hljs-string">'GBR'</span>][<span class="hljs-number">0</span>], <span class="hljs-string">'to'</span>, case_ranges[<span class="hljs-string">'GBR'</span>][<span class="hljs-number">1</span>])
print(<span class="hljs-string">'SWE'</span>, case_ranges[<span class="hljs-string">'SWE'</span>][<span class="hljs-number">0</span>], <span class="hljs-string">'to'</span>, case_ranges[<span class="hljs-string">'SWE'</span>][<span class="hljs-number">1</span>])
</code></pre>
<pre><code>GBR 2020-02-28 00:00:00 to 2020-04-03 00:00:00
SWE 2020-02-28 00:00:00 to 2020-04-03 00:00:00
</code></pre>
<p>This means that the dates where we observe these rates of growth begin on the 1th of March in both UK and in Sweden. Point 5 in the plot is therefore March 5th.</p>
<p>So what happened between March 5th and March 18th in the UK, where the rate of growth seemed to have been between quite high? And what happened in Sweden?</p>
<h3>UK: Contact tracing</h3>
<p>Contact tracing is a reasonably decent strategy. Assuming you have enough capacity, you should be able to find everyone in contact with the infected person, and also their contacts and so on. It should work reasonably well for most viruses, especially those that have mainly symptomatic spread.</p>
<p>Unfortunately SARS-COV-2 seems to have had an asymptomatic component. The virus quickly entered the community spread phase.</p>
<p>PHE gave up on contact tracing due to being overwhelmed on March 11th. That would be somewhere afterpoint 20. Growth rate still very high, above 2.0. No measures were in place at that time.</p>
<p>After an additional week or two of nothing much, UK finally implemented a lockdown on March 23rd</p>
<h3>Sweden: Mass measures</h3>
<ul>
<li>Feb 27th: Almega, the largest organization of service companies in Sweden advised employees to stay at home if they visited high risk areas</li>
<li>March 3rd: The Scandinavian airline SAS stopped all flights to northern Italy</li>
<li>March 11: The government announced that the qualifying day of sickness ('karensdag') will be temporarily abolished in order to ensure that people feeling slightly ill will stay at home from work. This means that the state will pay sick pay allowance from the first day the employee is absent from work</li>
</ul>
<h2>Mobility trends</h2>
<p>But these are all just decrees. Lets see what really happened by looking at google mobility trends</p>
<pre><code class="language-python">dateparse = <span class="hljs-keyword">lambda</span> x: datetime.strptime(x, <span class="hljs-string">'%b %d, %Y'</span>)
mobility = pd.read_csv(<span class="hljs-string">'https://drive.google.com/u/0/uc?id=1M4GY_K4y6KZtkDtz7i12fhs8LeyUTyaK&amp;export=download'</span>, parse_dates=[<span class="hljs-string">'Date'</span>], date_parser=dateparse)
</code></pre>
<pre><code class="language-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">extract_mobility</span><span class="hljs-params">(code, name)</span>:</span>
    mob = mobility[mobility.Code.eq(code)]
    colname = code + <span class="hljs-string">' '</span> + name
    mobranged = mob.loc[(mobility[<span class="hljs-string">'Date'</span>] &gt;= case_ranges[code][<span class="hljs-number">0</span>]) &amp; (mobility[<span class="hljs-string">'Date'</span>] &lt;= case_ranges[code][<span class="hljs-number">1</span>])];
    mobnamed = mobranged.reset_index().rename(columns={<span class="hljs-string">''</span>+name: colname})[colname]
    <span class="hljs-keyword">return</span> mobnamed

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_item</span><span class="hljs-params">(name)</span>:</span>
    plt = pd.concat([extract_mobility(<span class="hljs-string">'GBR'</span>, name), extract_mobility(<span class="hljs-string">'SWE'</span>, name)], axis=<span class="hljs-number">1</span>).plot(grid=<span class="hljs-literal">True</span>)
</code></pre>
<pre><code class="language-python">plot_item(<span class="hljs-string">'Workplaces (%)'</span>)
plot_item(<span class="hljs-string">'Residential (%)'</span>)
plot_item(<span class="hljs-string">'Transit Stations (%)'</span>)
</code></pre>
<p><img src="/posts/uk-sweden-growth/output_13_0.png" alt="png"></p>
<p><img src="/posts/uk-sweden-growth/output_13_1.png" alt="png"></p>
<p><img src="/posts/uk-sweden-growth/output_13_2.png" alt="png"></p>
<p>Really interesting. Looks like already took matters into their own hands in the UK as much as possible starting March 11th. Things really only take off after March 15th though, with the reduction of workplaces.</p>
<p>Lets superimpose the two charts for the UK - the &quot;stay at home&quot; chart and the &quot;growth rate&quot; chart:</p>
<pre><code class="language-python">plt = pd.concat([extract_mobility(<span class="hljs-string">'GBR'</span>, <span class="hljs-string">'Residential (%)'</span>), growth(<span class="hljs-string">'GBR'</span>).rename(<span class="hljs-string">'GBR Growth * 10'</span>).iloc[:<span class="hljs-number">35</span>] * <span class="hljs-number">10</span>], axis=<span class="hljs-number">1</span>).plot(grid=<span class="hljs-literal">True</span>)
</code></pre>
<p><img src="/posts/uk-sweden-growth/output_15_0.png" alt="png"></p>
<p>Say what? Staying at home seems to overlap very well with the 21-day adjusted drop of the growth rate in deaths? Who would've thought.</p>
<p>Note that Sweden reacted to the pandemic a day or two days earlier than the UK did but the difference doesn't seem significant - it could largely be an artifact of us trying to align the moment where the virus was equally wide-spread within the population.</p>
<p>Regardless, its still wrong to compare UK with Sweden when the early pre-measures rates of growth are different. To show why, I will use a car analogy</p>
<h3>The car analogy</h3>
<p>Lets say we have two car models from the same company, World Cars. World cars are a bit quirky, they like to name their cars by countries in the world. We would like to decide which one to buy and one of the factors we're interested in is safety. Specifically, we want to know how well the brakes work.</p>
<p>To determine which car is better, we try to look up at some data on braking tests. We find the
following two datapoints for the cars:</p>
<table>
<thead>
<tr>
<th>Car name</th>
<th>Brake distance</th>
</tr>
</thead>
<tbody>
<tr>
<td>UK</td>
<td>32 m</td>
</tr>
<tr>
<td>Sweden</td>
<td>30 m</td>
</tr>
</tbody>
</table>
<p>Oh, nice. It looks like the brakes are pretty similar, with Sweden's being slightly better.</p>
<p>But then you notice something odd about these two tests. It looks like they were performed at
different initial speeds!</p>
<table>
<thead>
<tr>
<th>Car name</th>
<th>Brake distance</th>
<th>Initial speed</th>
</tr>
</thead>
<tbody>
<tr>
<td>UK</td>
<td>32 m</td>
<td>80 km/h</td>
</tr>
<tr>
<td>Sweden</td>
<td>30 m</td>
<td>40 km/h</td>
</tr>
</tbody>
</table>
<p>Wait a minute. This comparison makes no sense now! In fact its quite likely that the UK car brakes are way more effective,  being able to stop in just 32m from a starting speed of 80 km/h. A little <a href="https://www.johannes-strommer.com/diverses/pages-in-english/stopping-distance-acceleration-speed/">back of the napkin</a> math shows that UK's brake distance for an initial speed of 40 km/h would be just 8 meters:</p>
<table>
<thead>
<tr>
<th>Car name</th>
<th>Brake distance</th>
<th>Initial speed</th>
</tr>
</thead>
<tbody>
<tr>
<td>UK</td>
<td>8 m</td>
<td>40 km/h</td>
</tr>
<tr>
<td>Sweden</td>
<td>30 m</td>
<td>40 km/h</td>
</tr>
</tbody>
</table>
<p>Now lets look at the rate of growth chart for daily deaths again:</p>
<p><img src="/posts/uk-sweden-growth/output_7_0.png" alt="png"></p>
<p>Just as we can't compare the effectiveness of brakes by the distance traveled if the initial speed
is different, we can't compare the effectiveness of measures by the number of cases per million if
the initial rate of growth was different. Different rate of growth means that different brakes are
needed.</p>
<blockquote>
<p>Note: with cases its probably even worse as exponential (and near-exponential) growth is far more
dramatic than the quadratic growth caused by acceleration</p>
</blockquote>
</div><div class="comments"><hr/><a href="posts/uk-sweden-growth/index.html#_comments">comment or share</a></div></article><article class="post"><h1><a href="posts/machine-learning-ethics.html">Machine learning ethics</a></h1><div class="date">Tue Dec 19 2017</div><div class="content"><p>Today I found and watched one of the most important videos on machine learning published this year</p>
<blockquote>
<p>We're building a dystopia just to make people click on ads
https://www.youtube.com/watch?v=iFTWM7HV2UI&amp;app=desktop</p>
</blockquote>
<p>Go watch it first before reading ahead! I could not possibly summarise it without doing it a
disservice.</p>
<p>What struck me most was the following quote:</p>
<blockquote>
<p>Having interviewed people who worked at Facebook, I'm convinced that nobody there really
understands how it [the machine learning system] works.</p>
</blockquote>
<p>The important question is, howcome nobody understands how a machine learning system works? You
would think, its because the system is very complex, its hard for any one person to understand it
fully. Thats not the problem.</p>
<p>The problem is fundamental to machine learning systems.</p>
<p>A machine learning system is a program that is given a target goal, a list of possible actions,
a history of previous actions and how well they achieved the goal in a past context.
The system should learn on the historical data and be able to predict what action it can select to
best achieve the goal.</p>
<p>Lets see what these parts would represent on say, YouTube, for a ML system that has to pick which
videos to show on the sidebar right next to the video you're watching.</p>
<p>The target goal could be e.g. to maximise the time the user stays on YouTube, watching videos.
More generally, a <em>value function</em> is given by the ML system creator that measures the desireability
of a certain outcome or behaviour (it could include multiple things like number of product bought,
number of ads clicked or viewed, etc).</p>
<p>The action the system can take is the choice of videos in the sidebar. Every different set of videos
would be a different alternative action, and could cause the user to either stay on YouTube longer
or perhaps leave the site.</p>
<p>Finally, the history of actions includes all previous video lists shown in the sidebar to users,
together with the value function outcome from them: the time the user spent on the website after
being  presented that list. Additional context from that time is also included: which user was it,
what was their personal information, their past watching history, the channels they're subscribed
to, videos they liked, videos they disliked and so on.</p>
<p>Based on this data, the system learns how to tailor its actions (the videos it shows) so that it
achieves the goal by picking the right action for a given context.</p>
<p>At the beginning it will try random things. After several iterations, it will find which things
seem to maximize value in which context.</p>
<p>Once trained with sufficient data, it will be able to do some calculations and conclude: &quot;well,
when I encountered a situation like this other times, I tried these five options, and option two
on average caused users like this one to stay the longest, so I'll do that&quot;.</p>
<p>Sure, there are ways to ask some ML systems why they made a decision after the fact, and they can
elaborate the variables that had the most effect. But before the algorithm gets the training data,
you <em>don't</em> know what it will decide - nobody does! It learns from the history of its own actions
and how the users reacted to them, so in essence, the users are programming its behaviour (through
the lens of its value function).</p>
<p>Lets say the system learnt that people who have cat videos in their watch history will stay a lot
longer if they are given cat videos in their suggestion box. Nothing groundbreaking there.</p>
<p>Now lets say it figures out the same action is appropriate when they are watching something
unrelated, like academic lecture material, because past data suggests that people of that profile
leave slightly earlier when given more lecture videos, while they stay for hours when given cat
videos, giving up the lecture videos.</p>
<p>This raises a very important question - is the system behaving in an ethical manner? Is it ethical
to show cat videos to a person trying to study and nudge them towards wasting their time? Even that
is a fairly benign example. There are far worse examples mentioned in the TED talk above.</p>
<p>The root of the problem is the value function. Our systems are often blisfully unaware of any side
effects their decision may cause and blatantly disregard basic rules of behaviour that we take for
granted. They have no other values than the value function they're maximizing. For them, the end
justifies the means. Whether the value function is maximized by manipulating people, preying on
their insecurities, making them scared, angry or sad - all of that is unimportant. Here is a scary
proposition: if a person is epileptic, it might learn that the best way to keep thenm &quot;on the website&quot;
is to show them something that will render them unconscious. It wouldn't even know that it didn't
really achieve the goal: as far as it knows, autoplay is on and they haven't stopped it in the past
two hours, so it all must be &quot;good&quot;.</p>
<p>So how do we make these systems ethical?</p>
<p>The first challenge is technical, and its the easiest one. How do we come up with a value function
that encodes additional basic values of of human ethics? Its easy as pie! You take a bunch of
ethicists, give them various situations and ask them to rate actions as ethical/unethical. Then once
you have enough data, you train a new value function so that the system can learn some basic humanity.
You end up with a an ethics function, and you create a new value function that combines the old
value function with the ethics function into the new value function. As a result the system starts
picking more ethical actions. All done. (If only things were that easy!)</p>
<p>The second challenge is a business one. How far are you willing to reduce your value maximisation
to be ethical? What to do if your competitor doesn't do that? What are the ethics of putting a
number on how much ethics you're willing to sacrifice for profits? (Spoiler alert: they're not
great)</p>
<p>One way to solve that is to have regulations for ethical behaviour of machine learning systems.
Such systems could be held responsible for unethical actions. If those actions are reported by
people, investigated by experts and found true in court, the company owning the ML system is held
liable. Unethical behaviour of machine learning systems shouldn't be <em>too</em> difficult to spot,
although getting evidence might prove difficult. Public pressure and exposure of companies seems
to help too. Perhaps we could make a machine learning systems that detects unethical behaviour and
call it the ML police. Citizens could agree to install the ML police add-on to help monitor
and aggregate behaviour of online ML systems. (If these suggestions look silly, its because they
are).</p>
<p>Another way to deal with this is to mandate that all ML systems have a feedback feature.
The user (or a responsible guardian of the user) should be able to log on to the system, see its
past actions within a given context and rate them as ethical or unethical. The system must be
designed to use this data and give it precedence when making decisions, such that actions that are
computed to be more ethical are always picked over actions that are less ethical. In this scenario
the users are the ethicists.</p>
<p>The third challenge is philosophical. Until now, philosophers were content with &quot;there is no right
answer, but there have been many thoughts on what exactly is ethical&quot;. They better get their act
together, because we'll need them to come up with a definite, quantifiable answer real soon.</p>
<p>On the more optimistic side, I hope that any generally agreed upon &quot;standard&quot; ethical system will
be a better starting point than having none at all.</p>
</div><div class="comments"><hr/><a href="posts/machine-learning-ethics.html#_comments">comment or share</a></div></article><hr/><h1>Older posts</h1><h4 class="post"><a href="posts/javascript-is-not-cancer.html">JavaScript isn't cancer</a></h4><h4 class="post"><a href="posts/es7-async-await-step-in-the-wrong-direction.html">ES7 async functions - a step in the wrong direction</a></h4><h4 class="post"><a href="posts/why-i-am-switching-to-promises.html">Why I am switching to promises</a></h4><h4 class="post"><a href="posts/closures-are-unavoidable-in-node.html">Closures are unavoidable in node</a></h4><h4 class="post"><a href="posts/analysis-generators-and-other-async-patterns-node.html">Analysis of generators and other async patterns in node</a></h4><h4 class="post"><a href="posts/make-most-webapps-work-on-ipad.html">Google Docs on the iPad</a></h4><h4 class="post"><a href="posts/introducing-npmsearch.html">Introducing npmsearch</a></h4><h4 class="post"><a href="posts/fixing-hackernews-mathematical-approach.html">Fixing Hacker News with a reputation system</a></h4><h4 class="post"><a href="posts/let-it-snow.html">Let it snow</a></h4><h4 class="post"><a href="posts/why-native-sucks--rocks-porting-windows-8.html">Why native sucks and HTML5 rocks</a></h4><h4 class="post"><a href="posts/intuitive-javascript-array-filtering-function-pt2.html">Intuitive JavaScript array filtering function pt2</a></h4><h4 class="post"><a href="posts/intuitive-javascript-array-filtering-function.html">Intuitive JavaScript array filtering function pt1</a></h4><h4 class="post"><a href="posts/amateur-lasse-gjertsen.html">Amateur - Lasse Gjertsen</a></h4></div></main></div><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.css"><script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script src="/scripts/jquery.flot.js"></script><script src="/scripts/jquery.flot.highlightSeries.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-1803JM8K3L"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-1803JM8K3L');</script></body></html>